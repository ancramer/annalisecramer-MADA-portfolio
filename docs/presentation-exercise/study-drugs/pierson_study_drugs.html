<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Analysis for the story College Students Aren’t The Only Ones Abusing Adderall – Annie's Data Analysis Portfolio</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Annie’s Data Analysis Portfolio</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../aboutme.html"> 
<span class="menu-text">About Me</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-projects" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Projects</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-projects">    
        <li>
    <a class="dropdown-item" href="../../starter-analysis-exercise/products/report/starter-analysis-report.html">
 <span class="dropdown-text">Starter Analysis Exercise</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../coding-exercise/coding-exercise.html">
 <span class="dropdown-text">R Coding Exercise</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../data-exercise/data-exercise.html">
 <span class="dropdown-text">Data Exercise</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../cdcdata-exercise/cdcdata-exercise.html">
 <span class="dropdown-text">Data Analysis Exercise</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../presentation-exercise/visualization-exercise.html">
 <span class="dropdown-text">Presentation Exercise</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../fitting-exercise/fitting-exercise.html">
 <span class="dropdown-text">Fitting Exercise</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/ancramer/annalisecramer-MADA-portfolio"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Analysis for the story <a href="http://fivethirtyeight.com/features/college-students-arent-the-only-ones-abusing-adderall">College Students Aren’t The Only Ones Abusing Adderall</a></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div id="cell-2" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-3" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.core.display <span class="im">import</span> HTML</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> css_styling():</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    styles <span class="op">=</span> <span class="st">"&lt;style&gt;div.cell{width:100%;margin-left:1%;margin-right:auto;}.container { width:100% !important; } &lt;/style&gt; "</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> HTML(styles)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>css_styling()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<style>div.cell{width:100%;margin-left:1%;margin-right:auto;}.container { width:100% !important; } </style> 
</div>
</div>
<section id="first-load-data" class="level1">
<h1>First load data</h1>
<div id="cell-5" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pylab <span class="im">import</span> <span class="op">*</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.iolib.summary2 <span class="im">import</span> summary_col</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co">#load in NSDUH data</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>nsduh_data <span class="op">=</span> pd.read_csv(<span class="st">'ICPSR_35509/DS0001/35509-0001-Data.tsv'</span>, sep <span class="op">=</span> <span class="st">'</span><span class="ch">\t</span><span class="st">'</span>)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co">#load in Niche data</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>niche_data <span class="op">=</span> pd.read_csv(<span class="st">'niche/SchoolPoll.csv'</span>)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co">#load in IPEDS data</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> getIPEDSData():</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    files <span class="op">=</span> [<span class="st">'ipeds_data/CSV_7312015-162.csv'</span>, <span class="st">'ipeds_data/CSV_7312015-826.csv'</span>]</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, f <span class="kw">in</span> <span class="bu">enumerate</span>(files):</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>        d <span class="op">=</span> pd.read_csv(f)</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>        d.index <span class="op">=</span> d.unitid </span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>        <span class="kw">del</span> d[<span class="st">'unitid'</span>]</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>            all_d <span class="op">=</span> d</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>            all_d <span class="op">=</span> pd.concat([all_d, d])</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    ipeds_d <span class="op">=</span> {}</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> c <span class="kw">in</span> all_d.columns:</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>        new_name <span class="op">=</span> c.replace(<span class="st">' - '</span>, <span class="st">'_'</span>).replace(<span class="st">'/'</span>, <span class="st">'_'</span>).replace(<span class="st">','</span>, <span class="st">'_'</span>).replace(<span class="st">'.'</span>, <span class="st">'_'</span>).replace(<span class="st">' '</span>, <span class="st">'_'</span>)</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>        new_name <span class="op">=</span> new_name.replace(<span class="st">"Percent_of_total_enrollment_that_are_"</span>, <span class="st">''</span>)</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>        ipeds_d[new_name] <span class="op">=</span> <span class="bu">dict</span>(<span class="bu">zip</span>(all_d.index, all_d[c]))</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ipeds_d</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>ipeds_data <span class="op">=</span> getIPEDSData()</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a><span class="co">#load in Google data</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>google_filenames <span class="op">=</span> [<span class="st">'ADHD_Indexed.csv'</span>,<span class="st">'Adderall_Indexed.csv'</span>]</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>google_data <span class="op">=</span> {}</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> filename <span class="kw">in</span> google_filenames:</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>    d <span class="op">=</span> pd.read_csv(os.path.join(<span class="st">'google_data'</span>, filename))</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>    d.index <span class="op">=</span> d.Month</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>    <span class="kw">del</span> d[<span class="st">'Month'</span>]</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>    d <span class="op">=</span> d.transpose()</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>    google_data[filename.replace(<span class="st">'_Indexed.csv'</span>, <span class="st">''</span>)] <span class="op">=</span> d</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="when-i-looked-at-more-recent-data-the-2013-national-survey-on-drug-use-and-health-nsduh-an-annual-government-survey-that-includes-more-than-55000-americans-the-difference-turned-out-to-be-closer-to-1.3x-not-2x." class="level6">
<h6 class="anchored" data-anchor-id="when-i-looked-at-more-recent-data-the-2013-national-survey-on-drug-use-and-health-nsduh-an-annual-government-survey-that-includes-more-than-55000-americans-the-difference-turned-out-to-be-closer-to-1.3x-not-2x.">“When I looked at more recent data (the 2013 National Survey on Drug Use and Health (NSDUH), an annual government survey that includes more than 55,000 Americans) the difference turned out to be closer to 1.3x, not 2x.”</h6>
<div id="cell-7" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#People who respond 1 have used Adderall non-medically; no one else has.  </span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>nsduh_data[<span class="st">'ADDERALL'</span>] <span class="op">=</span> (nsduh_data[<span class="st">'ADDERALL'</span>] <span class="op">==</span> <span class="dv">1</span>)<span class="op">*</span><span class="fl">1.</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>nsduh_data[<span class="st">'RITALIN'</span>] <span class="op">=</span> (nsduh_data[<span class="st">'RITMPHEN'</span>] <span class="op">==</span> <span class="dv">1</span>)<span class="op">*</span><span class="fl">1.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-8" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> stratifyByCat(nsduh_data, cat, drug_to_measure <span class="op">=</span> <span class="st">'ADDERALL'</span>, sortByVal <span class="op">=</span> <span class="va">False</span>):</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Checked. Computes the weighted and unweighted mean values of Adderall, stratifying by </span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">    the levels in cat. </span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    levels <span class="op">=</span> <span class="bu">sorted</span>(<span class="bu">list</span>(<span class="bu">set</span>(nsduh_data[cat].dropna())))</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span> <span class="st">'Category'</span>, cat</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    table <span class="op">=</span> []</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> l <span class="kw">in</span> levels:</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>        idxs <span class="op">=</span> nsduh_data[cat] <span class="op">==</span> l</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>        summed_weights <span class="op">=</span> nsduh_data.loc[idxs][<span class="st">'ANALWT_C'</span>].<span class="bu">sum</span>()</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>        mu <span class="op">=</span> (nsduh_data.loc[idxs][drug_to_measure] <span class="op">*</span> nsduh_data.loc[idxs][<span class="st">'ANALWT_C'</span>]).<span class="bu">sum</span>() <span class="op">/</span> summed_weights</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>        unweighted_mu <span class="op">=</span> nsduh_data.loc[idxs][drug_to_measure].mean()</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> idxs.<span class="bu">sum</span>() <span class="op">&gt;</span> <span class="dv">25</span>:</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>            table.append([drug_to_measure, l, mu, unweighted_mu, idxs.<span class="bu">sum</span>()])</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> sortByVal:</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>        table <span class="op">=</span> <span class="bu">sorted</span>(table, key <span class="op">=</span> <span class="kw">lambda</span> x:x[<span class="dv">2</span>])[::<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> row <span class="kw">in</span> table:</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span> <span class="st">'Mean value of </span><span class="sc">%s</span><span class="st"> for level </span><span class="sc">%s</span><span class="st"> is </span><span class="sc">%2.3f</span><span class="st">; unweighted, </span><span class="sc">%2.3f</span><span class="st"> (</span><span class="sc">%i</span><span class="st"> values)'</span> <span class="op">%</span> (<span class="bu">tuple</span>(row))</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span> <span class="st">'Ratio between maximum value and minimum value'</span>, <span class="bu">max</span>([a[<span class="dv">2</span>] <span class="cf">for</span> a <span class="kw">in</span> table]) <span class="op">/</span> <span class="bu">min</span>([a[<span class="dv">2</span>] <span class="cf">for</span> a <span class="kw">in</span> table])</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> <span class="st">'COLLENR levels:</span><span class="ch">\n</span><span class="st">1: FT college students age 18 - 22; 2: other age 18 - 22; 3: other'</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>stratifyByCat(nsduh_data, <span class="st">'COLLENR'</span>)     </span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>stratifyByCat(nsduh_data, <span class="st">'COLLENR'</span>, drug_to_measure <span class="op">=</span> <span class="st">'RITALIN'</span>)     </span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>COLLENR levels:
1: FT college students age 18 - 22; 2: other age 18 - 22; 3: other
Category COLLENR
Mean value of ADDERALL for level 1 is 0.149; unweighted, 0.140 (4310 values)
Mean value of ADDERALL for level 2 is 0.115; unweighted, 0.114 (6934 values)
Mean value of ADDERALL for level 3 is 0.034; unweighted, 0.048 (43914 values)
Ratio between maximum value and minimum value 4.45754687876
Category COLLENR
Mean value of RITALIN for level 1 is 0.048; unweighted, 0.048 (4310 values)
Mean value of RITALIN for level 2 is 0.050; unweighted, 0.049 (6934 values)
Mean value of RITALIN for level 3 is 0.022; unweighted, 0.026 (43914 values)
Ratio between maximum value and minimum value 2.2055874138</code></pre>
</div>
</div>
</section>
<section id="this-is-far-smaller-than-the-difference-between-white-18---22-year-olds-and-black-18---22-year-olds-6x-18-vs-3-or-the-difference-between-18---22-year-olds-whose-families-do-not-receive-food-stamps-and-those-whose-do-1.6x-14-vs-9." class="level6">
<h6 class="anchored" data-anchor-id="this-is-far-smaller-than-the-difference-between-white-18---22-year-olds-and-black-18---22-year-olds-6x-18-vs-3-or-the-difference-between-18---22-year-olds-whose-families-do-not-receive-food-stamps-and-those-whose-do-1.6x-14-vs-9.">“This is far smaller than the difference between white 18 - 22 year olds and black 18 - 22 year olds (6x, 18% vs 3%) or the difference between 18 - 22 year olds whose families do not receive food stamps and those whose do (1.6x, 14% vs 9%).”</h6>
<div id="cell-10" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>young_people_idxs <span class="op">=</span> nsduh_data[<span class="st">'COLLENR'</span>].<span class="bu">map</span>(<span class="kw">lambda</span> x:x <span class="kw">in</span> [<span class="dv">1</span>, <span class="dv">2</span>])</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> <span class="st">'</span><span class="ch">\n</span><span class="st">Categories for race:</span><span class="ch">\n</span><span class="st">1: white, 2: black, 3: Native Am; 4: Native HI/Other Pac Isl; 5: Asian; 6: Multiracial; 7: Hispanic'</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>stratifyByCat(nsduh_data.loc[young_people_idxs], <span class="st">'NEWRACE2'</span>)  </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>stratifyByCat(nsduh_data.loc[young_people_idxs], <span class="st">'NEWRACE2'</span>, drug_to_measure <span class="op">=</span> <span class="st">'RITALIN'</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> <span class="st">'Categories for food stamp: 1: respondent or family member received food stamp; 2: did not'</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>stratifyByCat(nsduh_data.loc[young_people_idxs], <span class="st">'IRFSTAMP'</span>)    </span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>stratifyByCat(nsduh_data.loc[young_people_idxs], <span class="st">'IRFSTAMP'</span>, drug_to_measure <span class="op">=</span> <span class="st">'RITALIN'</span>) </span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Categories for race:
1: white, 2: black, 3: Native Am; 4: Native HI/Other Pac Isl; 5: Asian; 6: Multiracial; 7: Hispanic
Category NEWRACE2
Mean value of ADDERALL for level 1 is 0.181; unweighted, 0.171 (6194 values)
Mean value of ADDERALL for level 2 is 0.031; unweighted, 0.034 (1602 values)
Mean value of ADDERALL for level 3 is 0.052; unweighted, 0.086 (163 values)
Mean value of ADDERALL for level 4 is 0.084; unweighted, 0.078 (64 values)
Mean value of ADDERALL for level 5 is 0.084; unweighted, 0.086 (532 values)
Mean value of ADDERALL for level 6 is 0.113; unweighted, 0.155 (491 values)
Mean value of ADDERALL for level 7 is 0.076; unweighted, 0.065 (2198 values)
Ratio between maximum value and minimum value 5.84203431864
Category NEWRACE2
Mean value of RITALIN for level 1 is 0.071; unweighted, 0.069 (6194 values)
Mean value of RITALIN for level 2 is 0.007; unweighted, 0.009 (1602 values)
Mean value of RITALIN for level 3 is 0.026; unweighted, 0.037 (163 values)
Mean value of RITALIN for level 4 is 0.013; unweighted, 0.016 (64 values)
Mean value of RITALIN for level 5 is 0.029; unweighted, 0.028 (532 values)
Mean value of RITALIN for level 6 is 0.054; unweighted, 0.067 (491 values)
Mean value of RITALIN for level 7 is 0.026; unweighted, 0.022 (2198 values)
Ratio between maximum value and minimum value 9.9793813036
Categories for food stamp: 1: respondent or family member received food stamp; 2: did not
Category IRFSTAMP
Mean value of ADDERALL for level 1 is 0.088; unweighted, 0.089 (2564 values)
Mean value of ADDERALL for level 2 is 0.140; unweighted, 0.135 (8680 values)
Ratio between maximum value and minimum value 1.59577871899
Category IRFSTAMP
Mean value of RITALIN for level 1 is 0.041; unweighted, 0.043 (2564 values)
Mean value of RITALIN for level 2 is 0.051; unweighted, 0.050 (8680 values)
Ratio between maximum value and minimum value 1.24093935037</code></pre>
</div>
</div>
</section>
<section id="graphs-on-adderall-usage-by-age" class="level3">
<h3 class="anchored" data-anchor-id="graphs-on-adderall-usage-by-age">Graphs on Adderall usage by age</h3>
<div id="cell-12" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> remapAges(x):</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x <span class="op">&lt;=</span> <span class="dv">3</span>:</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'12 - 14'</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> x <span class="op">&lt;=</span> <span class="dv">6</span>:</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'15 - 17'</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> x <span class="op">&lt;=</span> <span class="dv">10</span>:</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'college age'</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> x <span class="op">&lt;=</span> <span class="dv">12</span>:</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'23 - 25'</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> x <span class="op">&lt;=</span> <span class="dv">14</span>:</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'26 - 34'</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">'35+'</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>nsduh_data[<span class="st">'age_cat_to_plot'</span>] <span class="op">=</span> nsduh_data[<span class="st">'AGE2'</span>].<span class="bu">map</span>(remapAges)</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>nsduh_data[<span class="st">'age_cat_to_plot'</span>].loc[nsduh_data[<span class="st">'COLLENR'</span>] <span class="op">!=</span> <span class="dv">3</span>] <span class="op">=</span> np.nan</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="co">#This computes the values for Adderall usage stratified by age and college enrollment. </span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>stratifyByCat(nsduh_data, <span class="st">'COLLENR'</span>)  </span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>stratifyByCat(nsduh_data, <span class="st">'age_cat_to_plot'</span>) </span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a><span class="co">#This prints out the actual data in an easy form for making graphs. Kind of hacky. </span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>col_vals <span class="op">=</span> [<span class="fl">0.4</span>, <span class="fl">4.3</span>, <span class="fl">11.5</span>, <span class="fl">14.9</span>,  <span class="fl">14.5</span>, <span class="fl">10.2</span>, <span class="fl">1.1</span>]</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>col_labels <span class="op">=</span> [<span class="st">'12-14'</span>, <span class="st">'15-17'</span>, <span class="st">'18-22 (Not College)'</span>, <span class="st">'18-22 (In College)'</span>, <span class="st">'23-25'</span>, <span class="st">'26-34'</span>, <span class="st">'35+'</span>]</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> <span class="st">'Age</span><span class="ch">\t</span><span class="st">Percent Using Adderall'</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(col_vals)):</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span> <span class="st">'</span><span class="sc">%s</span><span class="ch">\t</span><span class="sc">%2.1f</span><span class="st">'</span> <span class="op">%</span> (col_labels[i], col_vals[i])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Category COLLENR
Mean value of ADDERALL for level 1 is 0.149; unweighted, 0.140 (4310 values)
Mean value of ADDERALL for level 2 is 0.115; unweighted, 0.114 (6934 values)
Mean value of ADDERALL for level 3 is 0.034; unweighted, 0.048 (43914 values)
Ratio between maximum value and minimum value 4.45754687876
Category age_cat_to_plot
Mean value of ADDERALL for level 12 - 14 is 0.004; unweighted, 0.005 (8689 values)
Mean value of ADDERALL for level 15 - 17 is 0.043; unweighted, 0.043 (9047 values)
Mean value of ADDERALL for level 23 - 25 is 0.145; unweighted, 0.140 (6896 values)
Mean value of ADDERALL for level 26 - 34 is 0.102; unweighted, 0.089 (5446 values)
Mean value of ADDERALL for level 35+ is 0.011; unweighted, 0.015 (13836 values)
Ratio between maximum value and minimum value 33.1820207109
Age Percent Using Adderall
12-14   0.4
15-17   4.3
18-22 (Not College) 11.5
18-22 (In College)  14.9
23-25   14.5
26-34   10.2
35+ 1.1</code></pre>
</div>
</div>
<section id="study-drugs-were-most-frequently-used-in-new-england-schools" class="level6">
<h6 class="anchored" data-anchor-id="study-drugs-were-most-frequently-used-in-new-england-schools">“Study drugs were most frequently used in New England schools”</h6>
<div id="cell-14" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Join Niche data with IPEDS data. </span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>niche_adderall_idxs <span class="op">=</span> (niche_data[<span class="st">'Response'</span>] <span class="op">==</span> <span class="st">'Prescription "study drugs" (Adderall, Ritalin) '</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>niche_adderall_fracs <span class="op">=</span> niche_data.loc[niche_adderall_idxs]</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>at_least_ten_responses <span class="op">=</span> niche_adderall_fracs[<span class="st">'ResponseCt'</span>] <span class="op">&gt;=</span> <span class="dv">10</span><span class="co">#filter out schools with very few responses. </span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>niche_adderall_fracs <span class="op">=</span> niche_adderall_fracs.loc[at_least_ten_responses]</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> school_characteristic <span class="kw">in</span> ipeds_data.keys():</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    niche_adderall_fracs[school_characteristic] <span class="op">=</span> niche_adderall_fracs[<span class="st">'IPEDS_Id'</span>].<span class="bu">map</span>(<span class="kw">lambda</span> x:ipeds_data[school_characteristic][x]</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>                                                                      <span class="cf">if</span> x <span class="kw">in</span> ipeds_data[school_characteristic]</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>                                                                      <span class="cf">else</span> <span class="va">None</span>)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Make geographic plot and run regression to confirm discrepancies are significant. </span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>region_vals <span class="op">=</span> []</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>region_names <span class="op">=</span> []</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> region <span class="kw">in</span> <span class="bu">list</span>(<span class="bu">set</span>(ipeds_data[<span class="st">'HD2013_Geographic_region'</span>].values())):</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    region_idxs <span class="op">=</span> niche_adderall_fracs[<span class="st">'HD2013_Geographic_region'</span>] <span class="op">==</span> region</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> region_idxs.<span class="bu">sum</span>() <span class="op">&gt;=</span> <span class="dv">10</span>:</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>        mean_val <span class="op">=</span> niche_adderall_fracs.loc[region_idxs][<span class="st">'PctOfTotal'</span>].mean()</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> np.isnan(mean_val):</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>        region_vals.append(mean_val)</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>        region_names.append(<span class="st">' '</span>.join([a <span class="cf">for</span> a <span class="kw">in</span> region.split() <span class="cf">if</span> <span class="bu">len</span>(a) <span class="op">&gt;</span> <span class="dv">2</span>]))</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> sm.OLS.from_formula(<span class="st">'PctOfTotal ~ HD2013_Geographic_region'</span>, data <span class="op">=</span> niche_adderall_fracs).fit()</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> model.summary()</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>region_vals <span class="op">=</span> np.array(region_vals)</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>region_names <span class="op">=</span> np.array(region_names)</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>sorted_idxs <span class="op">=</span> np.argsort(region_vals)</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>barh(<span class="bu">range</span>(<span class="bu">len</span>(region_vals)), region_vals[sorted_idxs])</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>yticks(np.arange(<span class="bu">len</span>(region_vals)) <span class="op">+</span> <span class="fl">.5</span>, region_names[sorted_idxs])</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>subplots_adjust(left <span class="op">=</span> <span class="fl">.3</span>)</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">'Proportion of students reporting that prescription study drugs</span><span class="ch">\n</span><span class="st"> are among the most popular on campus'</span>)</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>        </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                            OLS Regression Results                            
==============================================================================
Dep. Variable:             PctOfTotal   R-squared:                       0.126
Model:                            OLS   Adj. R-squared:                  0.110
Method:                 Least Squares   F-statistic:                     7.700
Date:                Tue, 03 Nov 2015   Prob (F-statistic):           1.18e-09
Time:                        14:09:22   Log-Likelihood:                 350.49
No. Observations:                 436   AIC:                            -683.0
Df Residuals:                     427   BIC:                            -646.3
Df Model:                           8                                         
Covariance Type:            nonrobust                                         
=============================================================================================================================================
                                                                                coef    std err          t      P&gt;|t|      [95.0% Conf. Int.]
---------------------------------------------------------------------------------------------------------------------------------------------
Intercept                                                                     0.2824      0.016     17.881      0.000         0.251     0.313
HD2013_Geographic_region[T.Great Lakes IL IN MI OH WI]                        0.0604      0.021      2.901      0.004         0.019     0.101
HD2013_Geographic_region[T.Mid East DE DC MD NJ NY PA]                        0.1021      0.019      5.330      0.000         0.064     0.140
HD2013_Geographic_region[T.New England CT ME MA NH RI VT]                     0.1152      0.022      5.283      0.000         0.072     0.158
HD2013_Geographic_region[T.Outlying areas AS FM GU MH MP PR PW VI]            0.1047      0.111      0.946      0.344        -0.113     0.322
HD2013_Geographic_region[T.Plains IA KS MN MO NE ND SD]                       0.0775      0.027      2.871      0.004         0.024     0.131
HD2013_Geographic_region[T.Rocky Mountains CO ID MT UT WY]                   -0.0432      0.030     -1.457      0.146        -0.102     0.015
HD2013_Geographic_region[T.Southeast AL AR FL GA KY LA MS NC SC TN VA WV]     0.0891      0.019      4.579      0.000         0.051     0.127
HD2013_Geographic_region[T.Southwest AZ NM OK TX]                             0.0558      0.025      2.191      0.029         0.006     0.106
==============================================================================
Omnibus:                       10.358   Durbin-Watson:                   1.920
Prob(Omnibus):                  0.006   Jarque-Bera (JB):               10.752
Skew:                           0.384   Prob(JB):                      0.00463
Kurtosis:                       2.941   Cond. No.                         22.7
==============================================================================

Warnings:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="pierson_study_drugs_files/figure-html/cell-9-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-15" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Create data for chart (this chart did not end up being included).</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> <span class="st">'Region</span><span class="ch">\t</span><span class="st">Proportion'</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(region_names)):</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span> <span class="st">'</span><span class="sc">%s</span><span class="ch">\t</span><span class="sc">%2.1f</span><span class="st">'</span> <span class="op">%</span> (region_names[sorted_idxs[::<span class="op">-</span><span class="dv">1</span>][i]], region_vals[sorted_idxs[::<span class="op">-</span><span class="dv">1</span>][i]] <span class="op">*</span> <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Region  Proportion
New England 39.8
Mid East    38.5
Southeast   37.2
Plains  36.0
Great Lakes 34.3
Southwest   33.8
Far West    28.2
Rocky Mountains 23.9</code></pre>
</div>
</div>
</section>
<section id="study-drugs-were-also-more-frequently-used-at-colleges-that-were-more-selective-or-had-higher-median-sat-or-act-scores.-in-the-graph-below-each-point-represents-one-school-the-horizontal-axis-is-the-schools-75th-percentile-act-score-and-the-vertical-axis-is-the-fraction-of-students-responding-that-study-drugs-are-popular.-the-correlation-is-highly-statistically-significant" class="level6">
<h6 class="anchored" data-anchor-id="study-drugs-were-also-more-frequently-used-at-colleges-that-were-more-selective-or-had-higher-median-sat-or-act-scores.-in-the-graph-below-each-point-represents-one-school-the-horizontal-axis-is-the-schools-75th-percentile-act-score-and-the-vertical-axis-is-the-fraction-of-students-responding-that-study-drugs-are-popular.-the-correlation-is-highly-statistically-significant">“Study drugs were also more frequently used at colleges that were more selective or had higher median SAT or ACT scores. In the graph below, each point represents one school; the horizontal axis is the school’s 75th percentile ACT score, and the vertical axis is the fraction of students responding that study drugs are popular. The correlation is highly statistically significant”</h6>
<div id="cell-17" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>achievement_columns <span class="op">=</span> [<span class="st">'IC2013_SAT_Critical_Reading_75th_percentile_score'</span>, <span class="st">'IC2013_SAT_Writing_75th_percentile_score'</span>, </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>                       <span class="st">'IC2013_SAT_Math_75th_percentile_score'</span>, <span class="st">'IC2013_ACT_Composite_75th_percentile_score'</span>, <span class="st">'DRVIC2013_Percent_admitted_total'</span>]</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>control_columns <span class="op">=</span> [<span class="st">'DRVEF2013_White'</span>, <span class="st">'DRVEF2013_women'</span>, <span class="st">'IC2013_Institutional_control_or_affiliation'</span>, </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'DRVEF2013_Asian'</span>, <span class="st">'DRVEF2013_American_Indian_or_Alaska_Native'</span>, </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'DRVEF2013_Black_or_African_American'</span>, <span class="st">'EFEST2013_Estimated_enrollment__total'</span>, </span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'DRVEF2013_Hispanic_Latino'</span>, <span class="st">'DRVEF2013_Native_Hawaiian_or_Other_Pacific_Islander'</span>]</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> <span class="st">"""</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="st">Regressing percentage of students at each college saying study drugs are popular on various measures of college selectivity. </span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="st">For each measure of selectivity (first column) we run two regressions: </span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="st">a simple model -- study_drugs_popular ~ selectivity_measure</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="st">a more complex model -- study_drugs_popular ~ selectivity_measure + college_covs</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="st">where college_covs are college_racial_breakdown, college_gender_breakdown, college_type, and college_estimated_enrollment</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="st">below the columns are selectivity_measure, simple_selectivity_measure_beta, simple_selectivity_measure_p, complex_selectivity_measure_beta, complex_selectivity_measure_p</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> coef <span class="kw">in</span> achievement_columns:</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> sm.OLS.from_formula(<span class="st">'PctOfTotal ~ </span><span class="sc">%s</span><span class="st">'</span> <span class="op">%</span> coef, data <span class="op">=</span> niche_adderall_fracs).fit()</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>    model_controlling_for_covariates <span class="op">=</span> sm.OLS.from_formula(<span class="st">'PctOfTotal ~ </span><span class="sc">%s</span><span class="st"> + </span><span class="sc">%s</span><span class="st">'</span> <span class="op">%</span> (coef, <span class="st">'+'</span>.join(control_columns)), data <span class="op">=</span> niche_adderall_fracs).fit()</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span> <span class="st">'</span><span class="sc">%-60s</span><span class="st"> </span><span class="sc">%3.5f</span><span class="st"> </span><span class="sc">%2.3e</span><span class="st"> </span><span class="sc">%3.5f</span><span class="st"> </span><span class="sc">%2.3e</span><span class="st">'</span> <span class="op">%</span> (coef, model.params[coef], model.pvalues[coef], </span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>                                 model_controlling_for_covariates.params[coef], model_controlling_for_covariates.pvalues[coef])</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>scatter(niche_adderall_fracs[<span class="st">'IC2013_ACT_Composite_75th_percentile_score'</span>], niche_adderall_fracs[<span class="st">'PctOfTotal'</span>])</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>xlabel(<span class="st">'75th Percentile ACT Score'</span>)</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>ylabel(<span class="st">'Fraction of Students Reporting Adderall Popular'</span>)</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>xlim([<span class="dv">20</span>, <span class="dv">36</span>])</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>ylim([<span class="dv">0</span>, <span class="fl">.7</span>])</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>show()</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>                       </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Regressing percentage of students at each college saying study drugs are popular on various measures of college selectivity. 
For each measure of selectivity (first column) we run two regressions: 
a simple model -- study_drugs_popular ~ selectivity_measure
a more complex model -- study_drugs_popular ~ selectivity_measure + college_covs
where college_covs are college_racial_breakdown, college_gender_breakdown, college_type, and college_estimated_enrollment

below the columns are selectivity_measure, simple_selectivity_measure_beta, simple_selectivity_measure_p, complex_selectivity_measure_beta, complex_selectivity_measure_p

IC2013_SAT_Critical_Reading_75th_percentile_score            0.00068 1.352e-13 0.00057 9.374e-07
IC2013_SAT_Writing_75th_percentile_score                     0.00059 3.890e-10 0.00062 2.139e-06
IC2013_SAT_Math_75th_percentile_score                        0.00062 1.922e-13 0.00074 4.848e-10
IC2013_ACT_Composite_75th_percentile_score                   0.01531 5.626e-18 0.01551 1.232e-09
DRVIC2013_Percent_admitted_total                             -0.00129 2.996e-06 -0.00141 3.155e-06</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="pierson_study_drugs_files/figure-html/cell-11-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-18" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Print out data for chart. </span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> sm.OLS.from_formula(<span class="st">'PctOfTotal ~ IC2013_ACT_Composite_75th_percentile_score'</span>, data <span class="op">=</span> niche_adderall_fracs).fit()</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>ones_to_plot <span class="op">=</span> niche_adderall_fracs[[<span class="st">'IC2013_ACT_Composite_75th_percentile_score'</span>, <span class="st">'PctOfTotal'</span>]].dropna()</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>ones_to_plot[<span class="st">'trendline'</span>] <span class="op">=</span> niche_adderall_fracs[<span class="st">'IC2013_ACT_Composite_75th_percentile_score'</span>] <span class="op">*</span> model.params[<span class="st">'IC2013_ACT_Composite_75th_percentile_score'</span>] <span class="op">+</span> model.params[<span class="st">'Intercept'</span>]</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>ones_to_plot[<span class="st">'trendline'</span>] <span class="op">=</span> ones_to_plot[<span class="st">'trendline'</span>] <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> <span class="st">'ACT</span><span class="ch">\t</span><span class="st">Adderall</span><span class="ch">\t</span><span class="st">Trendline'</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(ones_to_plot)):</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span> <span class="st">'</span><span class="sc">%2.3f</span><span class="ch">\t</span><span class="sc">%2.3f</span><span class="ch">\t</span><span class="sc">%2.3f</span><span class="st">'</span> <span class="op">%</span> (ones_to_plot[<span class="st">'IC2013_ACT_Composite_75th_percentile_score'</span>].iloc[i],</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>                                   ones_to_plot[<span class="st">'PctOfTotal'</span>].iloc[i] <span class="op">*</span> <span class="dv">100</span>, </span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>                                   ones_to_plot[<span class="st">'trendline'</span>].iloc[i])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ACT Adderall    Trendline
27.000  31.480  35.021
29.000  42.110  38.082
30.000  47.960  39.613
23.000  23.260  28.898
28.000  36.960  36.552
28.000  33.910  36.552
23.000  27.120  28.898
30.000  60.000  39.613
27.000  53.130  35.021
24.000  30.890  30.429
29.000  34.040  38.082
29.000  28.330  38.082
30.000  45.160  39.613
30.000  43.750  39.613
23.000  28.260  28.898
26.000  29.070  33.490
33.000  64.710  44.205
30.000  48.760  39.613
33.000  68.970  44.205
24.000  31.330  30.429
28.000  51.350  36.552
32.000  28.570  42.674
31.000  7.720   41.144
25.000  7.180   31.959
34.000  29.170  45.736
27.000  62.160  35.021
32.000  50.000  42.674
30.000  34.690  39.613
26.000  40.000  33.490
30.000  43.180  39.613
26.000  15.180  33.490
24.000  29.070  30.429
22.000  10.680  27.367
24.000  12.350  30.429
24.000  22.360  30.429
22.000  19.650  27.367
22.000  13.890  27.367
20.000  11.460  24.306
23.000  28.000  28.898
34.000  41.940  45.736
26.000  23.260  33.490
27.000  35.560  35.021
33.000  37.140  44.205
27.000  40.540  35.021
25.000  21.150  31.959
24.000  34.650  30.429
23.000  26.090  28.898
29.000  34.180  38.082
28.000  25.000  36.552
31.000  54.130  41.144
25.000  20.310  31.959
23.000  37.680  28.898
32.000  48.000  42.674
32.000  47.730  42.674
28.000  55.130  36.552
23.000  40.000  28.898
32.000  40.630  42.674
30.000  33.850  39.613
32.000  39.390  42.674
31.000  29.410  41.144
27.000  32.370  35.021
34.000  40.380  45.736
29.000  37.930  38.082
34.000  48.810  45.736
30.000  37.210  39.613
34.000  43.590  45.736
31.000  68.750  41.144
28.000  30.000  36.552
31.000  54.170  41.144
30.000  31.860  39.613
34.000  42.550  45.736
27.000  40.820  35.021
24.000  48.480  30.429
22.000  36.360  27.367
24.000  30.770  30.429
24.000  28.260  30.429
24.000  25.420  30.429
24.000  14.130  30.429
23.000  28.070  28.898
28.000  39.470  36.552
22.000  29.550  27.367
26.000  50.000  33.490
30.000  25.640  39.613
32.000  40.910  42.674
25.000  53.330  31.959
24.000  38.570  30.429
25.000  38.890  31.959
24.000  25.560  30.429
24.000  30.610  30.429
27.000  25.900  35.021
27.000  28.570  35.021
29.000  49.810  38.082
30.000  40.540  39.613
25.000  50.000  31.959
28.000  25.810  36.552
31.000  60.240  41.144
33.000  47.690  44.205
26.000  32.650  33.490
32.000  44.590  42.674
25.000  40.560  31.959
25.000  26.200  31.959
26.000  37.230  33.490
32.000  38.460  42.674
23.000  15.940  28.898
27.000  55.000  35.021
35.000  30.560  47.267
26.000  47.460  33.490
28.000  32.840  36.552
29.000  39.020  38.082
26.000  15.280  33.490
24.000  13.510  30.429
26.000  35.560  33.490
22.000  23.610  27.367
30.000  51.530  39.613
22.000  28.710  27.367
24.000  19.640  30.429
25.000  24.620  31.959
28.000  30.220  36.552
27.000  47.320  35.021
27.000  50.000  35.021
34.000  52.830  45.736
24.000  28.240  30.429
25.000  34.420  31.959
22.000  27.660  27.367
25.000  33.330  31.959
31.000  46.430  41.144
26.000  48.280  33.490
32.000  57.500  42.674
26.000  7.270   33.490
23.000  41.670  28.898
28.000  52.890  36.552
29.000  39.130  38.082
29.000  37.000  38.082
29.000  44.440  38.082
28.000  33.330  36.552
27.000  41.670  35.021
29.000  47.140  38.082
24.000  22.810  30.429
26.000  40.740  33.490
26.000  40.910  33.490
27.000  50.000  35.021
28.000  30.000  36.552
23.000  13.890  28.898
30.000  57.380  39.613
28.000  41.880  36.552
24.000  31.780  30.429
33.000  57.690  44.205
24.000  29.270  30.429
24.000  40.540  30.429
28.000  34.380  36.552
26.000  28.570  33.490
31.000  33.330  41.144
25.000  52.380  31.959
25.000  35.480  31.959
27.000  23.290  35.021
23.000  28.570  28.898
24.000  16.380  30.429
32.000  48.190  42.674
30.000  38.390  39.613
26.000  27.270  33.490
33.000  40.000  44.205
25.000  22.950  31.959
24.000  27.000  30.429
25.000  16.220  31.959
25.000  33.330  31.959
24.000  32.260  30.429
34.000  32.760  45.736
26.000  30.770  33.490
31.000  37.380  41.144
26.000  42.640  33.490
27.000  57.140  35.021
28.000  37.840  36.552
23.000  30.970  28.898
27.000  35.510  35.021
25.000  36.230  31.959
25.000  61.760  31.959
29.000  36.840  38.082
23.000  35.140  28.898
23.000  33.330  28.898
32.000  43.480  42.674
28.000  43.590  36.552
30.000  36.130  39.613
27.000  53.230  35.021
22.000  41.670  27.367
26.000  35.290  33.490
31.000  38.710  41.144
22.000  35.290  27.367
31.000  41.380  41.144
25.000  24.390  31.959
31.000  21.880  41.144
29.000  50.980  38.082
24.000  25.860  30.429
26.000  30.230  33.490
30.000  34.210  39.613
28.000  41.670  36.552
27.000  27.910  35.021
24.000  36.960  30.429
26.000  42.000  33.490
26.000  41.380  33.490
23.000  27.420  28.898
26.000  42.940  33.490
24.000  20.740  30.429
25.000  27.160  31.959
31.000  35.480  41.144
27.000  20.800  35.021
28.000  33.330  36.552
27.000  31.250  35.021
30.000  66.670  39.613
22.000  38.100  27.367
27.000  44.120  35.021
30.000  32.350  39.613
23.000  32.690  28.898
25.000  26.190  31.959
24.000  30.000  30.429
22.000  22.640  27.367
25.000  20.000  31.959
25.000  16.950  31.959
31.000  58.460  41.144
26.000  18.570  33.490
24.000  28.950  30.429
26.000  38.100  33.490
27.000  50.000  35.021
27.000  27.350  35.021
30.000  42.310  39.613
24.000  29.270  30.429
34.000  20.750  45.736
24.000  28.410  30.429
28.000  21.430  36.552
30.000  33.650  39.613
25.000  41.030  31.959
26.000  35.710  33.490
25.000  40.480  31.959
26.000  25.580  33.490
29.000  44.000  38.082
27.000  22.220  35.021
26.000  42.590  33.490
24.000  34.210  30.429
26.000  32.500  33.490
27.000  35.710  35.021
28.000  47.480  36.552
23.000  23.210  28.898
27.000  31.070  35.021
26.000  28.210  33.490
29.000  40.840  38.082
23.000  30.770  28.898
29.000  63.460  38.082
25.000  43.200  31.959
27.000  47.100  35.021
24.000  39.220  30.429
25.000  34.910  31.959
29.000  51.520  38.082
24.000  27.270  30.429
30.000  29.730  39.613
33.000  31.580  44.205
32.000  64.620  42.674
31.000  43.330  41.144
26.000  50.000  33.490
28.000  40.210  36.552
25.000  27.030  31.959
30.000  47.930  39.613
28.000  28.570  36.552
27.000  38.100  35.021
28.000  49.170  36.552
33.000  35.810  44.205
29.000  17.050  38.082
27.000  16.550  35.021
31.000  35.100  41.144
24.000  14.930  30.429
25.000  23.530  31.959
31.000  33.330  41.144
29.000  47.620  38.082
26.000  17.200  33.490
26.000  37.500  33.490
28.000  30.090  36.552
35.000  38.100  47.267
28.000  35.430  36.552
29.000  38.380  38.082
25.000  18.750  31.959
30.000  51.970  39.613
29.000  45.830  38.082
29.000  44.700  38.082
30.000  37.500  39.613
31.000  43.010  41.144
30.000  44.390  39.613
26.000  35.090  33.490
27.000  24.730  35.021
27.000  26.940  35.021
26.000  31.030  33.490
31.000  40.000  41.144
28.000  55.280  36.552
28.000  47.790  36.552
28.000  50.440  36.552
25.000  32.690  31.959
28.000  25.300  36.552
26.000  31.340  33.490
29.000  31.940  38.082
29.000  38.130  38.082
25.000  40.000  31.959
28.000  28.890  36.552
25.000  17.500  31.959
32.000  46.360  42.674
32.000  41.780  42.674
27.000  22.920  35.021
26.000  60.530  33.490
30.000  31.030  39.613
27.000  55.560  35.021
28.000  52.800  36.552
26.000  30.000  33.490
28.000  27.470  36.552
24.000  11.590  30.429
26.000  27.340  33.490
26.000  30.770  33.490
25.000  23.380  31.959
25.000  19.260  31.959
25.000  32.260  31.959
25.000  23.260  31.959
26.000  45.900  33.490
32.000  45.120  42.674
25.000  40.830  31.959
26.000  31.820  33.490
26.000  28.890  33.490
26.000  23.300  33.490
24.000  28.240  30.429
24.000  33.330  30.429
34.000  19.300  45.736
29.000  44.860  38.082
27.000  42.860  35.021
34.000  38.100  45.736
30.000  35.970  39.613
30.000  35.480  39.613
26.000  42.570  33.490
31.000  54.290  41.144
32.000  31.250  42.674
30.000  46.250  39.613
27.000  34.090  35.021
27.000  40.000  35.021
26.000  21.740  33.490
29.000  47.480  38.082
26.000  34.380  33.490
28.000  30.120  36.552
33.000  30.970  44.205
27.000  23.810  35.021
28.000  40.000  36.552
26.000  39.290  33.490
29.000  51.430  38.082
25.000  44.230  31.959
25.000  25.640  31.959
26.000  22.790  33.490
31.000  44.700  41.144
31.000  18.920  41.144
21.000  19.790  25.837
25.000  25.000  31.959
25.000  22.730  31.959
32.000  47.830  42.674
27.000  23.130  35.021
29.000  49.300  38.082
33.000  40.660  44.205
30.000  28.160  39.613
26.000  28.380  33.490
22.000  34.020  27.367
30.000  52.590  39.613
26.000  25.490  33.490
26.000  24.070  33.490
24.000  34.860  30.429
24.000  32.760  30.429
25.000  25.640  31.959
24.000  31.580  30.429
27.000  22.080  35.021
27.000  9.870   35.021
24.000  30.160  30.429
34.000  52.080  45.736
33.000  34.380  44.205
31.000  50.850  41.144
26.000  25.630  33.490
27.000  43.480  35.021
33.000  62.500  44.205
29.000  41.380  38.082
25.000  28.480  31.959
34.000  27.140  45.736
26.000  21.650  33.490
33.000  36.670  44.205
26.000  51.580  33.490
24.000  32.610  30.429
23.000  21.670  28.898
25.000  31.430  31.959
25.000  42.150  31.959
28.000  27.030  36.552
22.000  45.450  27.367
28.000  27.500  36.552
25.000  37.040  31.959
29.000  25.640  38.082
25.000  32.350  31.959
25.000  22.730  31.959
27.000  48.840  35.021
35.000  27.910  47.267
25.000  34.620  31.959</code></pre>
</div>
</div>
</section>
<section id="when-i-looked-at-the-nsduh-data-i-found-that-college-students-who-had-used-adderall-non-medically-reported-significantly-higher-levels-of-depression-and-were-more-likely-to-have-considered-suicide." class="level6">
<h6 class="anchored" data-anchor-id="when-i-looked-at-the-nsduh-data-i-found-that-college-students-who-had-used-adderall-non-medically-reported-significantly-higher-levels-of-depression-and-were-more-likely-to-have-considered-suicide.">“When I looked at the NSDUH data, I found that college students who had used Adderall non-medically reported significantly higher levels of depression and were more likely to have considered suicide.”</h6>
<div id="cell-20" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> lookAtDepressionLevels(nsduh_data, idxs):</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    nsduh_data[<span class="st">'seriously_thought_about_killing_oneself_last_year'</span>] <span class="op">=</span> <span class="fl">1.</span><span class="op">*</span> (nsduh_data[<span class="st">'MHSUITHK'</span>] <span class="op">==</span> <span class="dv">1</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    nsduh_data[<span class="st">'worst_K6_score_past_year'</span>] <span class="op">=</span> <span class="fl">1.</span><span class="op">*</span>nsduh_data[<span class="st">'K6SCMAX'</span>]</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    data_to_use <span class="op">=</span> nsduh_data.loc[idxs]</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    weights <span class="op">=</span> data_to_use[<span class="st">'ANALWT_C'</span>]</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    stratifyByCat(data_to_use, <span class="st">'seriously_thought_about_killing_oneself_last_year'</span>)  </span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    model1 <span class="op">=</span> sm.Logit.from_formula(<span class="st">'ADDERALL ~ seriously_thought_about_killing_oneself_last_year'</span>, </span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>                                 weights <span class="op">=</span> weights, </span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>                                 data <span class="op">=</span> data_to_use).fit()</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    model2 <span class="op">=</span> sm.Logit.from_formula(<span class="st">'ADDERALL ~ seriously_thought_about_killing_oneself_last_year +  IRSEX + C(IRFSTAMP, Sum) + C(NEWRACE2, Sum)'</span>, </span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>                                 weights <span class="op">=</span> weights, </span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>                                 data <span class="op">=</span> data_to_use).fit()</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>    model3 <span class="op">=</span> sm.Logit.from_formula(<span class="st">'ADDERALL ~ worst_K6_score_past_year'</span>, </span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>                                 weights <span class="op">=</span> weights, </span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>                                 data <span class="op">=</span> data_to_use).fit()</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>    model4 <span class="op">=</span> sm.Logit.from_formula(<span class="st">'ADDERALL ~ worst_K6_score_past_year + IRSEX + C(IRFSTAMP, Sum) + C(NEWRACE2, Sum)'</span>, </span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>                                 weights <span class="op">=</span> weights, </span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>                                 data <span class="op">=</span> data_to_use).fit()</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>    models <span class="op">=</span> [model1, model2, model3, model4]</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span> summary_col(models, model_names <span class="op">=</span> <span class="bu">range</span>(<span class="bu">len</span>(models)), stars <span class="op">=</span> <span class="va">True</span>,</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>                      regressor_order <span class="op">=</span> [<span class="st">'seriously_thought_about_killing_oneself_last_year'</span>, <span class="st">'worst_K6_score_past_year'</span>],</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>                      float_format<span class="op">=</span><span class="st">'</span><span class="sc">%0.3f</span><span class="st">'</span>,</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>                      info_dict<span class="op">=</span>{<span class="st">'N'</span>:<span class="kw">lambda</span> x: <span class="st">"</span><span class="sc">{0:d}</span><span class="st">"</span>.<span class="bu">format</span>(<span class="bu">int</span>(x.nobs))})</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>college_idxs <span class="op">=</span> nsduh_data[<span class="st">'COLLENR'</span>] <span class="op">==</span> <span class="dv">1</span></span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>adult_idxs <span class="op">=</span> nsduh_data[<span class="st">'CATAG6'</span>] <span class="op">&gt;=</span> <span class="dv">3</span></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> <span class="st">'</span><span class="ch">\n\n</span><span class="st">Looking at depression levels in college students'</span></span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>lookAtDepressionLevels(nsduh_data, college_idxs)</span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> <span class="st">'</span><span class="ch">\n\n</span><span class="st">Looking at depression levels in adults'</span></span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>lookAtDepressionLevels(nsduh_data, adult_idxs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>

Looking at depression levels in college students
Category seriously_thought_about_killing_oneself_last_year
Mean value of ADDERALL for level 0.0 is 0.143; unweighted, 0.136 (3944 values)
Mean value of ADDERALL for level 1.0 is 0.213; unweighted, 0.191 (366 values)
Ratio between maximum value and minimum value 1.48723023239
Optimization terminated successfully.
         Current function value: 0.404718
         Iterations 6
Optimization terminated successfully.
         Current function value: 0.389079
         Iterations 7
Optimization terminated successfully.
         Current function value: 0.403017
         Iterations 6
Optimization terminated successfully.
         Current function value: 0.386725
         Iterations 7

=========================================================================================
                                                      0         1         2         3    
-----------------------------------------------------------------------------------------
seriously_thought_about_killing_oneself_last_year 0.410***  0.435***                     
                                                  (0.141)   (0.144)                      
worst_K6_score_past_year                                              0.033***  0.039*** 
                                                                      (0.007)   (0.007)  
C(IRFSTAMP, Sum)[S.1]                                       -0.059              -0.076   
                                                            (0.089)             (0.089)  
C(NEWRACE2, Sum)[S.1]                                       0.746***            0.754*** 
                                                            (0.186)             (0.186)  
C(NEWRACE2, Sum)[S.2]                                       -0.693***           -0.676***
                                                            (0.248)             (0.249)  
C(NEWRACE2, Sum)[S.3]                                       0.152               0.209    
                                                            (0.549)             (0.552)  
C(NEWRACE2, Sum)[S.4]                                       -0.499              -0.554   
                                                            (0.892)             (0.893)  
C(NEWRACE2, Sum)[S.5]                                       -0.038              -0.056   
                                                            (0.245)             (0.245)  
C(NEWRACE2, Sum)[S.6]                                       0.562**             0.533**  
                                                            (0.249)             (0.250)  
IRSEX                                                       -0.373***           -0.439***
                                                            (0.090)             (0.091)  
Intercept                                         -1.852*** -1.781*** -2.058*** -1.948***
                                                  (0.047)   (0.236)   (0.070)   (0.240)  
N                                                 4310      4310      4310      4310     
=========================================================================================
Standard errors in parentheses.
* p&lt;.1, ** p&lt;.05, ***p&lt;.01


Looking at depression levels in adults
Category seriously_thought_about_killing_oneself_last_year
Mean value of ADDERALL for level 0.0 is 0.026; unweighted, 0.034 (18526 values)
Mean value of ADDERALL for level 1.0 is 0.067; unweighted, 0.093 (756 values)
Ratio between maximum value and minimum value 2.54581324356
Optimization terminated successfully.
         Current function value: 0.153638
         Iterations 7
Optimization terminated successfully.
         Current function value: 0.148860
         Iterations 8
Optimization terminated successfully.
         Current function value: 0.147275
         Iterations 8
Optimization terminated successfully.
         Current function value: 0.142961
         Iterations 8

=========================================================================================
                                                      0         1         2         3    
-----------------------------------------------------------------------------------------
seriously_thought_about_killing_oneself_last_year 1.074***  0.908***                     
                                                  (0.132)   (0.135)                      
worst_K6_score_past_year                                              0.098***  0.097*** 
                                                                      (0.005)   (0.006)  
C(IRFSTAMP, Sum)[S.1]                                       0.292***            0.157*** 
                                                            (0.046)             (0.048)  
C(NEWRACE2, Sum)[S.1]                                       0.565***            0.529*** 
                                                            (0.111)             (0.112)  
C(NEWRACE2, Sum)[S.2]                                       -0.848***           -0.825***
                                                            (0.190)             (0.191)  
C(NEWRACE2, Sum)[S.3]                                       0.490*              0.433    
                                                            (0.263)             (0.267)  
C(NEWRACE2, Sum)[S.4]                                       0.225               0.309    
                                                            (0.446)             (0.448)  
C(NEWRACE2, Sum)[S.5]                                       -0.461*             -0.432   
                                                            (0.268)             (0.270)  
C(NEWRACE2, Sum)[S.6]                                       0.750***            0.668*** 
                                                            (0.199)             (0.201)  
IRSEX                                                       -0.262***           -0.415***
                                                            (0.078)             (0.080)  
Intercept                                         -3.357*** -3.090*** -3.948*** -3.505***
                                                  (0.041)   (0.158)   (0.061)   (0.163)  
N                                                 19282     19282     19282     19282    
=========================================================================================
Standard errors in parentheses.
* p&lt;.1, ** p&lt;.05, ***p&lt;.01</code></pre>
</div>
</div>
</section>
<section id="i-found-that-google-searches-for-adderall-in-college-towns-spiked-during-exam-months-and-drop-during-summer-months." class="level6">
<h6 class="anchored" data-anchor-id="i-found-that-google-searches-for-adderall-in-college-towns-spiked-during-exam-months-and-drop-during-summer-months.">“I found that Google searches for Adderall in college towns spiked during exam months and drop during summer months.”</h6>
<div id="cell-22" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>college_towns_to_percentages <span class="op">=</span> {}</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co">#read in college towns. </span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> line <span class="kw">in</span> <span class="bu">open</span>(<span class="st">'college_town_percentages'</span>):</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    line <span class="op">=</span> <span class="st">' '</span>.join(line.split()[<span class="dv">1</span>:])</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    city_name <span class="op">=</span> line.split(<span class="st">'('</span>)[<span class="dv">0</span>].strip()</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    percentage <span class="op">=</span> <span class="bu">float</span>(line.split(<span class="st">'('</span>)[<span class="dv">1</span>].replace(<span class="st">'%)'</span>, <span class="st">''</span>))</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> city_name <span class="kw">in</span> d.index:</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>        college_towns_to_percentages[city_name] <span class="op">=</span> percentage</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="co">#reprocess google data into easier-to-analyze format. </span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> createGoogleSearchDataframe(all_searches, college_towns_to_percentages):</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> {<span class="st">'month'</span>:[], <span class="st">'year'</span>:[], <span class="st">'town'</span>:[]}</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> k <span class="kw">in</span> all_searches:</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>        df[k] <span class="op">=</span> []</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>        df[k <span class="op">+</span> <span class="st">'_normalized_by_town'</span>] <span class="op">=</span> []</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>        df[k <span class="op">+</span> <span class="st">'_zero_meaned_by_town'</span>] <span class="op">=</span> []</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, town_name <span class="kw">in</span> <span class="bu">enumerate</span>(college_towns_to_percentages.keys()):</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">%</span> <span class="dv">10</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span> i,<span class="st">'towns processed out of'</span>, <span class="bu">len</span>(d.index)</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>        mean_vals_by_town <span class="op">=</span> {}</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>        bad_town <span class="op">=</span> <span class="va">False</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> k <span class="kw">in</span> all_searches:</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>            mean_vals_by_town[k] <span class="op">=</span> {}</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> town_name <span class="kw">not</span> <span class="kw">in</span> all_searches[k].index:</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span> town_name, <span class="st">'not in index'</span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>                bad_town <span class="op">=</span> <span class="va">True</span></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> town_name <span class="kw">in</span> all_searches[k].index:</span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>                mean_vals_by_town[k][<span class="st">'mu'</span>] <span class="op">=</span> all_searches[k].loc[town_name].mean()</span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>                mean_vals_by_town[k][<span class="st">'sigma'</span>] <span class="op">=</span> all_searches[k].loc[town_name].std()</span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> bad_town:</span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> date <span class="kw">in</span> all_searches[<span class="st">'Adderall'</span>].columns:</span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>            month <span class="op">=</span> date.split(<span class="st">'-'</span>)[<span class="dv">1</span>]</span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a>            year <span class="op">=</span> date.split(<span class="st">'-'</span>)[<span class="dv">0</span>]</span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>            df[<span class="st">'month'</span>].append(month)</span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a>            df[<span class="st">'year'</span>].append(year)</span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a>            df[<span class="st">'town'</span>].append(town_name)</span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> k <span class="kw">in</span> all_searches.keys():</span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a>                search_volume <span class="op">=</span> <span class="bu">float</span>(all_searches[k].loc[town_name][date])</span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a>                df[k].append(search_volume)</span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a>                df[k <span class="op">+</span> <span class="st">'_normalized_by_town'</span>].append((search_volume <span class="op">-</span> mean_vals_by_town[k][<span class="st">'mu'</span>]) <span class="op">/</span> mean_vals_by_town[k][<span class="st">'sigma'</span>])</span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a>                df[k <span class="op">+</span> <span class="st">'_zero_meaned_by_town'</span>].append((search_volume <span class="op">-</span> mean_vals_by_town[k][<span class="st">'mu'</span>]))</span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> a <span class="kw">in</span> df.keys():</span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span> a, <span class="bu">len</span>(df[a])</span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.DataFrame(df)</span>
<span id="cb21-48"><a href="#cb21-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb21-49"><a href="#cb21-49" aria-hidden="true" tabindex="-1"></a>google_search_dataframe <span class="op">=</span> createGoogleSearchDataframe(google_data, college_towns_to_percentages)</span>
<span id="cb21-50"><a href="#cb21-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-51"><a href="#cb21-51" aria-hidden="true" tabindex="-1"></a><span class="co">#Do regressions for various adjustments to the Google data to confirm we see the same pattern. </span></span>
<span id="cb21-52"><a href="#cb21-52" aria-hidden="true" tabindex="-1"></a><span class="co">#Eg, if we subtract off the mean for each town, do we still see it? What if we divide by each town's standard deviation...? Pattern is robust to all these things. </span></span>
<span id="cb21-53"><a href="#cb21-53" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> adjustment_to_use <span class="kw">in</span> [<span class="st">''</span>, <span class="st">'_normalized_by_town'</span>, <span class="st">'_zero_meaned_by_town'</span>]:</span>
<span id="cb21-54"><a href="#cb21-54" aria-hidden="true" tabindex="-1"></a>    figure(figsize <span class="op">=</span> [<span class="dv">5</span>, <span class="dv">5</span>])</span>
<span id="cb21-55"><a href="#cb21-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> k <span class="kw">in</span> [<span class="st">'Adderall'</span>, <span class="st">'ADHD'</span>]:</span>
<span id="cb21-56"><a href="#cb21-56" aria-hidden="true" tabindex="-1"></a>        model <span class="op">=</span> sm.OLS.from_formula(<span class="st">'</span><span class="sc">%s</span><span class="st"> ~ C(month, Sum) + C(year, Sum)'</span> </span>
<span id="cb21-57"><a href="#cb21-57" aria-hidden="true" tabindex="-1"></a>                                    <span class="op">%</span> (k <span class="op">+</span> adjustment_to_use), data <span class="op">=</span> google_search_dataframe).fit()</span>
<span id="cb21-58"><a href="#cb21-58" aria-hidden="true" tabindex="-1"></a>        month_coefs <span class="op">=</span> []</span>
<span id="cb21-59"><a href="#cb21-59" aria-hidden="true" tabindex="-1"></a>        month_ticks <span class="op">=</span> []</span>
<span id="cb21-60"><a href="#cb21-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> param <span class="kw">in</span> model.params.index:</span>
<span id="cb21-61"><a href="#cb21-61" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">'month'</span> <span class="kw">in</span> param:</span>
<span id="cb21-62"><a href="#cb21-62" aria-hidden="true" tabindex="-1"></a>                month_coefs.append(model.params[param])</span>
<span id="cb21-63"><a href="#cb21-63" aria-hidden="true" tabindex="-1"></a>                month_ticks.append(param.split(<span class="st">'S.'</span>)[<span class="dv">1</span>].replace(<span class="st">']'</span>, <span class="st">''</span>))</span>
<span id="cb21-64"><a href="#cb21-64" aria-hidden="true" tabindex="-1"></a>        month_coefs.append(<span class="op">-</span> np.mean(month_coefs))</span>
<span id="cb21-65"><a href="#cb21-65" aria-hidden="true" tabindex="-1"></a>        month_ticks.append(<span class="st">'12'</span>)</span>
<span id="cb21-66"><a href="#cb21-66" aria-hidden="true" tabindex="-1"></a>        plot(<span class="bu">range</span>(<span class="bu">len</span>(month_coefs)), month_coefs, label <span class="op">=</span> k)</span>
<span id="cb21-67"><a href="#cb21-67" aria-hidden="true" tabindex="-1"></a>        xticks(<span class="bu">range</span>(<span class="bu">len</span>(month_coefs)), month_ticks, rotation <span class="op">=</span> <span class="dv">90</span>)</span>
<span id="cb21-68"><a href="#cb21-68" aria-hidden="true" tabindex="-1"></a>    ylim([<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>])</span>
<span id="cb21-69"><a href="#cb21-69" aria-hidden="true" tabindex="-1"></a>    legend(loc <span class="op">=</span> <span class="dv">3</span>, fontsize <span class="op">=</span> <span class="dv">8</span>)</span>
<span id="cb21-70"><a href="#cb21-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-71"><a href="#cb21-71" aria-hidden="true" tabindex="-1"></a>    xlabel(<span class="st">'Month'</span>)</span>
<span id="cb21-72"><a href="#cb21-72" aria-hidden="true" tabindex="-1"></a>    ylabel(<span class="st">'Normalized Search Rate in College Towns'</span>)</span>
<span id="cb21-73"><a href="#cb21-73" aria-hidden="true" tabindex="-1"></a>    title(<span class="st">'Adjustment:'</span> <span class="op">+</span>adjustment_to_use)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0 towns processed out of 2084
Hamilton, New York not in index
Farmville, Virginia not in index
10 towns processed out of 2084
Canton, New York not in index
Orono, Maine not in index
20 towns processed out of 2084
Menomonie, Wisconsin not in index
Lexington, Virginia not in index
30 towns processed out of 2084
40 towns processed out of 2084
Geneseo, New York not in index
Kutztown, Pennsylvania not in index
50 towns processed out of 2084
60 towns processed out of 2084
Frostburg, Maryland not in index
70 towns processed out of 2084
town 4355
ADHD 4355
ADHD_zero_meaned_by_town 4355
month 4355
ADHD_normalized_by_town 4355
year 4355
Adderall 4355
Adderall_normalized_by_town 4355
Adderall_zero_meaned_by_town 4355</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="pierson_study_drugs_files/figure-html/cell-14-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="pierson_study_drugs_files/figure-html/cell-14-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="pierson_study_drugs_files/figure-html/cell-14-output-4.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="in-fact-nsduh-data-showed-that-adults-whose-family-incomes-were-below-10000-had-the-highest-rates-of-nonmedical-adderall-use-and-those-whose-family-incomes-were-greater-than-75000-had-the-lowest." class="level6">
<h6 class="anchored" data-anchor-id="in-fact-nsduh-data-showed-that-adults-whose-family-incomes-were-below-10000-had-the-highest-rates-of-nonmedical-adderall-use-and-those-whose-family-incomes-were-greater-than-75000-had-the-lowest.">“In fact, NSDUH data showed that adults whose family incomes were below 10,000 had the highest rates of nonmedical Adderall use, and those whose family incomes were greater than 75,000 had the lowest.”</h6>
<div id="cell-24" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">#run regressions + stratify by income levels to confirm that we observe income effects.</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>adult_idxs <span class="op">=</span> nsduh_data[<span class="st">'CATAG6'</span>] <span class="op">&gt;=</span> <span class="dv">3</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>data_to_use <span class="op">=</span> nsduh_data.loc[adult_idxs]</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>weights <span class="op">=</span> data_to_use[<span class="st">'ANALWT_C'</span>]</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> <span class="st">'Examining Adderall use frequency in adults as a function of family income'</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> <span class="st">'Ritalin results are qualitatively similar although the effects seem to be weaker'</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> <span class="st">'</span><span class="ch">\n</span><span class="st">Categories for total family income:</span><span class="ch">\n</span><span class="st">1: &lt;10k, 2: 10-20, 3: 20-30; 4: 30-40; 5: 40-50; 6: 50-75; 7: 75'</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>stratifyByCat(data_to_use, <span class="st">'IRFAMIN3'</span>)  </span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>stratifyByCat(data_to_use, <span class="st">'IRFAMIN3'</span>, drug_to_measure <span class="op">=</span> <span class="st">'RITALIN'</span>)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>model1 <span class="op">=</span> sm.Logit.from_formula(<span class="st">'ADDERALL ~ C(IRFAMIN3)'</span>, data <span class="op">=</span> data_to_use, weights <span class="op">=</span> weights).fit()<span class="co">#treat income as categorical variable</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>model2 <span class="op">=</span> sm.Logit.from_formula(<span class="st">'ADDERALL ~ IRFAMIN3'</span>, data <span class="op">=</span> data_to_use, weights <span class="op">=</span> weights).fit()<span class="co">#treat as continuous variable (bad, bad, bad)</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>model3 <span class="op">=</span> sm.Logit.from_formula(<span class="st">'ADDERALL ~ IRSEX + C(CATAG6, Sum) + C(NEWRACE2, Sum) + C(IRFAMIN3)'</span>, data <span class="op">=</span> data_to_use, weights <span class="op">=</span> weights).fit()<span class="co">#control for other covariates: age, race, sex. </span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>model4 <span class="op">=</span> sm.Logit.from_formula(<span class="st">'RITALIN ~ C(IRFAMIN3)'</span>, data <span class="op">=</span> data_to_use, weights <span class="op">=</span> weights).fit()</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>model5 <span class="op">=</span> sm.Logit.from_formula(<span class="st">'RITALIN ~ IRFAMIN3'</span>, data <span class="op">=</span> data_to_use, weights <span class="op">=</span> weights).fit()</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>model6 <span class="op">=</span> sm.Logit.from_formula(<span class="st">'RITALIN ~ IRSEX + C(CATAG6, Sum) + C(NEWRACE2, Sum) + C(IRFAMIN3)'</span>, data <span class="op">=</span> data_to_use, weights <span class="op">=</span> weights).fit()</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>models <span class="op">=</span> [model1, model2, model3, model4, model5, model6]</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> summary_col(models, model_names <span class="op">=</span> [<span class="st">'ADDERALL'</span>, <span class="st">'ADDERALL'</span>, <span class="st">'ADDERALL'</span>, <span class="st">'RITALIN'</span>, <span class="st">'RITALIN'</span>, <span class="st">'RITALIN'</span>], stars <span class="op">=</span> <span class="va">True</span>,</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>                  float_format<span class="op">=</span><span class="st">'</span><span class="sc">%0.3f</span><span class="st">'</span>,</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>                  info_dict<span class="op">=</span>{<span class="st">'N'</span>:<span class="kw">lambda</span> x: <span class="st">"</span><span class="sc">{0:d}</span><span class="st">"</span>.<span class="bu">format</span>(<span class="bu">int</span>(x.nobs))})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Examining Adderall use frequency in adults as a function of family income
Ritalin results are qualitatively similar although the effects seem to be weaker

Categories for total family income:
1: &lt;10k, 2: 10-20, 3: 20-30; 4: 30-40; 5: 40-50; 6: 50-75; 7: 75
Category IRFAMIN3
Mean value of ADDERALL for level 1 is 0.037; unweighted, 0.053 (1132 values)
Mean value of ADDERALL for level 2 is 0.025; unweighted, 0.036 (2308 values)
Mean value of ADDERALL for level 3 is 0.032; unweighted, 0.042 (2102 values)
Mean value of ADDERALL for level 4 is 0.032; unweighted, 0.040 (2100 values)
Mean value of ADDERALL for level 5 is 0.029; unweighted, 0.036 (2085 values)
Mean value of ADDERALL for level 6 is 0.028; unweighted, 0.033 (3418 values)
Mean value of ADDERALL for level 7 is 0.024; unweighted, 0.031 (6137 values)
Ratio between maximum value and minimum value 1.52577800068
Category IRFAMIN3
Mean value of RITALIN for level 1 is 0.030; unweighted, 0.038 (1132 values)
Mean value of RITALIN for level 2 is 0.018; unweighted, 0.025 (2308 values)
Mean value of RITALIN for level 3 is 0.024; unweighted, 0.031 (2102 values)
Mean value of RITALIN for level 4 is 0.026; unweighted, 0.031 (2100 values)
Mean value of RITALIN for level 5 is 0.018; unweighted, 0.022 (2085 values)
Mean value of RITALIN for level 6 is 0.022; unweighted, 0.026 (3418 values)
Mean value of RITALIN for level 7 is 0.020; unweighted, 0.025 (6137 values)
Ratio between maximum value and minimum value 1.67773828665
Optimization terminated successfully.
         Current function value: 0.154529
         Iterations 7
Optimization terminated successfully.
         Current function value: 0.154656
         Iterations 7
Optimization terminated successfully.
         Current function value: 0.132304
         Iterations 11
Optimization terminated successfully.
         Current function value: 0.124139
         Iterations 8
Optimization terminated successfully.
         Current function value: 0.124316
         Iterations 8
Optimization terminated successfully.
         Current function value: 0.111418
         Iterations 10

==========================================================================================
                      ADDERALL I ADDERALL II ADDERALL III RITALIN I RITALIN II RITALIN III
------------------------------------------------------------------------------------------
C(CATAG6, Sum)[S.3]                          2.208***                          1.373***   
                                             (0.186)                           (0.104)    
C(CATAG6, Sum)[S.4]                          0.742***                          0.467***   
                                             (0.191)                           (0.110)    
C(CATAG6, Sum)[S.5]                          -0.150                            -0.244*    
                                             (0.215)                           (0.139)    
C(IRFAMIN3)[T.2]      -0.406**               -0.387**     -0.426**             -0.426**   
                      (0.173)                (0.181)      (0.205)              (0.210)    
C(IRFAMIN3)[T.3]      -0.236                 -0.365**     -0.213               -0.360*    
                      (0.171)                (0.179)      (0.200)              (0.206)    
C(IRFAMIN3)[T.4]      -0.283                 -0.458**     -0.196               -0.401*    
                      (0.173)                (0.181)      (0.200)              (0.205)    
C(IRFAMIN3)[T.5]      -0.405**               -0.650***    -0.560***            -0.837***  
                      (0.177)                (0.185)      (0.215)              (0.221)    
C(IRFAMIN3)[T.6]      -0.484***              -0.825***    -0.390**             -0.785***  
                      (0.163)                (0.172)      (0.189)              (0.195)    
C(IRFAMIN3)[T.7]      -0.572***              -0.834***    -0.421**             -0.811***  
                      (0.152)                (0.161)      (0.175)              (0.182)    
C(NEWRACE2, Sum)[S.1]                        0.795***                          1.001***   
                                             (0.114)                           (0.139)    
C(NEWRACE2, Sum)[S.2]                        -0.798***                         -1.727***  
                                             (0.191)                           (0.346)    
C(NEWRACE2, Sum)[S.3]                        0.424                             0.441      
                                             (0.269)                           (0.334)    
C(NEWRACE2, Sum)[S.4]                        0.156                             0.411      
                                             (0.451)                           (0.516)    
C(NEWRACE2, Sum)[S.5]                        -0.606**                          -0.480     
                                             (0.270)                           (0.329)    
C(NEWRACE2, Sum)[S.6]                        0.858***                          1.182***   
                                             (0.203)                           (0.226)    
IRFAMIN3                         -0.068***                          -0.042*               
                                 (0.019)                            (0.022)               
IRSEX                                        -0.264***                         -0.326***  
                                             (0.080)                           (0.090)    
Intercept             -2.883***  -2.963***   -3.964***    -3.232*** -3.379***  -3.748***  
                      (0.133)    (0.096)     (0.274)      (0.155)   (0.112)    (0.256)    
N                     19282      19282       19282        19282     19282      19282      
==========================================================================================
Standard errors in parentheses.
* p&lt;.1, ** p&lt;.05, ***p&lt;.01</code></pre>
</div>
</div>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>